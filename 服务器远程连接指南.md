# 服务器远程连接指南

## 📋 概述

本指南介绍如何远程连接到生产服务器，以及服务器上重要文件的位置和配置信息。

## 🔑 SSH 连接配置

### 服务器信息
- **IP地址**: `47.115.94.203`
- **用户名**: `root`
- **SSH端口**: `22` (默认)

### SSH 密钥配置

#### 1. 本地SSH配置
在本地 `~/.ssh/config` 文件中添加：

```bash
Host douyin-server
    HostName 47.115.94.203
    User root
    IdentityFile ~/.ssh/id_rsa_douyin
    IdentitiesOnly yes
```

#### 2. 连接命令
```bash
# 使用配置的主机名连接
ssh douyin-server

# 或直接使用IP连接
ssh -i ~/.ssh/id_rsa_douyin root@47.115.94.203
```

#### 3. Windows PowerShell连接
```powershell
# 使用SSH连接
ssh douyin-server

# 或使用PuTTY等工具
putty.exe -ssh root@47.115.94.203 -i ~/.ssh/id_rsa_douyin.ppk
```

## 📁 服务器重要文件位置

### 项目根目录
```
/var/www/
├── douyin-admin-master/     # 后端项目源码
├── html/                    # 前端静态文件
├── backup_script.sh         # 备份脚本
├── deploy_script.sh         # 部署脚本
└── DEPLOYMENT-GUIDE.md      # 部署指南
```

### 后端项目结构 (`/var/www/douyin-admin-master/`)
```
douyin-admin-master/
├── server.js                # 后端服务器入口文件
├── database.sqlite          # SQLite数据库文件
├── package.json             # Node.js项目配置
├── models/                  # 数据库模型
│   ├── User.js             # 用户模型
│   ├── Game.js             # 游戏模型
│   ├── Token.js            # Token模型
│   └── UserGame.js         # 用户游戏关联模型
├── routes/                  # API路由
├── services/                # 业务服务
├── scripts/                 # 维护脚本
├── config/                  # 配置文件
└── docs/                    # 项目文档
```

### 前端文件结构 (`/var/www/html/`)
```
html/
├── index.html              # 前端入口文件
├── assets/                 # 静态资源文件 (39个文件)
│   ├── *.js               # JavaScript文件
│   ├── *.css              # CSS样式文件
│   └── *.gz               # 压缩文件
└── assets_backup_*/        # 旧文件备份目录
```

### 系统配置文件

#### Nginx 配置
```bash
# 主配置文件
/etc/nginx/nginx.conf

# 站点配置
/etc/nginx/sites-available/
├── ecpm-app              # 主应用配置
└── m-game                # 小游戏配置

# 启用的站点
/etc/nginx/sites-enabled/
```

#### PM2 进程管理
```bash
# PM2配置文件
# 通常在项目根目录或 /etc/pm2/ 下
```

#### 系统服务
```bash
# Nginx服务
sudo systemctl status nginx
sudo systemctl restart nginx

# PM2服务 (如果配置为systemd)
/etc/systemd/system/pm2-root.service
```

## 🔧 常用维护命令

### 服务器状态检查
```bash
# 系统状态
uptime
df -h
free -h

# 进程状态
ps aux | grep node
pm2 list
pm2 status

# 端口监听
netstat -tlnp | grep :80
netstat -tlnp | grep :3000
```

### 日志查看
```bash
# Nginx日志
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

# PM2日志
pm2 logs douyin-admin
pm2 logs douyin-admin --lines 50

# 系统日志
sudo journalctl -u nginx -f
sudo journalctl -u pm2-root -f
```

### 文件权限检查
```bash
# 检查项目文件权限
ls -la /var/www/douyin-admin-master/
ls -la /var/www/html/

# 修复权限 (如果需要)
sudo chown -R www-data:www-data /var/www/html/
sudo chown -R www-data:www-data /var/www/douyin-admin-master/
```

### 数据库操作
```bash
# 进入项目目录
cd /var/www/douyin-admin-master

# 数据库文件位置
ls -la database.sqlite

# 备份数据库
cp database.sqlite database.sqlite.backup

# 使用脚本检查数据库
node scripts/show-db-data.js
node scripts/check-table-structure.js
```

## 🚀 部署相关

### 前端部署
```bash
# 优先使用部署脚本（推荐）
./deploy-frontend.sh  # Linux
deploy-frontend.bat   # Windows

# 或手动部署
# 本地构建
npm run build

# 上传到服务器
scp -i ~/.ssh/id_rsa_douyin -r dist/* root@47.115.94.203:/var/www/html/
```

### 后端部署
```bash
# 上传代码
scp -i ~/.ssh/id_rsa_douyin -r src/ root@47.115.94.203:/var/www/douyin-admin-master/

# 重启服务
pm2 restart douyin-admin
```

### 备份操作
```bash
# 运行备份脚本
cd /var/www
./backup_script.sh
```

## 🔍 故障排除

### 连接问题
```bash
# 测试SSH连接
ssh -v douyin-server

# 检查密钥权限
ls -la ~/.ssh/id_rsa_douyin
chmod 600 ~/.ssh/id_rsa_douyin
```

### 服务问题
```bash
# 检查Nginx状态
sudo nginx -t
sudo systemctl status nginx

# 检查PM2状态
pm2 list
pm2 describe douyin-admin

# 重启服务
sudo systemctl restart nginx
pm2 restart douyin-admin
```

### 权限问题
```bash
# 检查文件权限
ls -la /var/www/html/
ls -la /var/www/douyin-admin-master/

# 修复权限
sudo chown -R www-data:www-data /var/www/html/
sudo chown -R www-data:www-data /var/www/douyin-admin-master/
```

## 📊 监控和维护

### 定期检查项目
```bash
# 检查磁盘使用情况
df -h /var/www

# 检查数据库大小
ls -lh /var/www/douyin-admin-master/database.sqlite

# 检查日志文件大小
du -sh /var/log/nginx/
pm2 logs --size
```

### 清理操作
```bash
# 清理Nginx日志
sudo truncate -s 0 /var/log/nginx/*.log

# 清理PM2日志
pm2 flush

# 清理旧备份文件 (谨慎操作)
find /var/www -name "*backup*" -type d -mtime +30
```

## 📞 紧急联系

如遇严重问题：
1. 检查服务器状态和日志
2. 查看PM2和Nginx状态
3. 检查数据库连接
4. 如需要，可回滚到备份版本

## 📝 更新日志

- **2025-10-11**: 初始版本创建，包含完整的服务器配置和文件位置信息