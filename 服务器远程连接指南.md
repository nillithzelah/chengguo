# æœåŠ¡å™¨è¿œç¨‹è¿æ¥æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•è¿œç¨‹è¿æ¥åˆ°ç”Ÿäº§æœåŠ¡å™¨ï¼Œä»¥åŠæœåŠ¡å™¨ä¸Šé‡è¦æ–‡ä»¶çš„ä½ç½®å’Œé…ç½®ä¿¡æ¯ã€‚

## ğŸ”‘ SSH è¿æ¥é…ç½®

### æœåŠ¡å™¨ä¿¡æ¯

#### ç”Ÿäº§æœåŠ¡å™¨ (åŸæœåŠ¡å™¨)
- **IPåœ°å€**: `47.115.94.203`
- **ç”¨æˆ·å**: `root`
- **SSHç«¯å£**: `22` (é»˜è®¤)
- **ç”¨é€”**: ç”Ÿäº§ç¯å¢ƒä¸»æœåŠ¡å™¨
<!-- 
#### æ–°æ¸¸æˆæœåŠ¡å™¨ (nb.game985.vip)
- **åŸŸå**: `nb.game985.vip`
- **ç”¨æˆ·å**: `root`
- **SSHç«¯å£**: `22` (é»˜è®¤)
- **ç”¨é€”**: æ–°æ¸¸æˆç½‘ç«™æœåŠ¡å™¨
- **Nginxé…ç½®**: `/etc/nginx/sites-available/nb-game` -->


### SSH å¯†é’¥é…ç½®

#### 1. æœ¬åœ°SSHé…ç½®
åœ¨æœ¬åœ° `~/.ssh/config` æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```bash
# ç”Ÿäº§æœåŠ¡å™¨é…ç½®
Host douyin-server
    HostName 47.115.94.203
    User root
    IdentityFile ~/.ssh/id_rsa_douyin
    IdentitiesOnly yes

# # æ–°æ¸¸æˆæœåŠ¡å™¨é…ç½®
# Host nb-game-server
#     HostName nb.game985.vip
#     User root
#     IdentityFile ~/.ssh/id_rsa_douyin
#     IdentitiesOnly yes

```

#### 2. è¿æ¥å‘½ä»¤
```bash
# ç”Ÿäº§æœåŠ¡å™¨è¿æ¥
ssh douyin-server
# æˆ–ç›´æ¥ä½¿ç”¨IPè¿æ¥
ssh -i ~/.ssh/id_rsa_douyin root@47.115.94.203

# # æ–°æ¸¸æˆæœåŠ¡å™¨è¿æ¥
# ssh nb-game-server
# # æˆ–ç›´æ¥ä½¿ç”¨åŸŸåè¿æ¥
# ssh -i ~/.ssh/id_rsa_douyin root@nb.game985.vip

```

#### 3. Windows PowerShellè¿æ¥
```powershell
# ä½¿ç”¨SSHè¿æ¥
ssh douyin-server
ssh nb-game-server

# æˆ–ä½¿ç”¨PuTTYç­‰å·¥å…·
putty.exe -ssh root@47.115.94.203 -i ~/.ssh/id_rsa_douyin.ppk
putty.exe -ssh root@nb.game985.vip -i ~/.ssh/id_rsa_douyin.ppk
```

## ğŸ“ æœåŠ¡å™¨é‡è¦æ–‡ä»¶ä½ç½®

### é¡¹ç›®æ ¹ç›®å½•
```
/var/www/
â”œâ”€â”€ douyin-admin-master/     # åç«¯é¡¹ç›®æºç 
â”œâ”€â”€ html/                    # å‰ç«¯é™æ€æ–‡ä»¶
â”œâ”€â”€ backup_script.sh         # å¤‡ä»½è„šæœ¬
â”œâ”€â”€ deploy_script.sh         # éƒ¨ç½²è„šæœ¬
â””â”€â”€ DEPLOYMENT-GUIDE.md      # éƒ¨ç½²æŒ‡å—
```

### åç«¯é¡¹ç›®ç»“æ„ (`/var/www/douyin-admin-master/`)
```
douyin-admin-master/
â”œâ”€â”€ server.js                # åç«¯æœåŠ¡å™¨å…¥å£æ–‡ä»¶
â”œâ”€â”€ database.sqlite          # SQLiteæ•°æ®åº“æ–‡ä»¶
â”œâ”€â”€ package.json             # Node.jsé¡¹ç›®é…ç½®
â”œâ”€â”€ models/                  # æ•°æ®åº“æ¨¡å‹
â”‚   â”œâ”€â”€ User.js             # ç”¨æˆ·æ¨¡å‹
â”‚   â”œâ”€â”€ Game.js             # æ¸¸æˆæ¨¡å‹
â”‚   â”œâ”€â”€ Token.js            # Tokenæ¨¡å‹
â”‚   â””â”€â”€ UserGame.js         # ç”¨æˆ·æ¸¸æˆå…³è”æ¨¡å‹
â”œâ”€â”€ routes/                  # APIè·¯ç”±
â”œâ”€â”€ services/                # ä¸šåŠ¡æœåŠ¡
â”œâ”€â”€ scripts/                 # ç»´æŠ¤è„šæœ¬
â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶
â””â”€â”€ docs/                    # é¡¹ç›®æ–‡æ¡£
```

### å‰ç«¯æ–‡ä»¶ç»“æ„ (`/var/www/html/`)
```
html/
â”œâ”€â”€ index.html              # å‰ç«¯å…¥å£æ–‡ä»¶
â”œâ”€â”€ assets/                 # é™æ€èµ„æºæ–‡ä»¶ (39ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ *.js               # JavaScriptæ–‡ä»¶
â”‚   â”œâ”€â”€ *.css              # CSSæ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ *.gz               # å‹ç¼©æ–‡ä»¶
â””â”€â”€ assets_backup_*/        # æ—§æ–‡ä»¶å¤‡ä»½ç›®å½•
```

### ç³»ç»Ÿé…ç½®æ–‡ä»¶

#### Nginx é…ç½®
```bash
# ä¸»é…ç½®æ–‡ä»¶
/etc/nginx/nginx.conf

# ç«™ç‚¹é…ç½®
/etc/nginx/sites-available/
â”œâ”€â”€ ecpm-app              # ä¸»åº”ç”¨é…ç½®
â”œâ”€â”€ m-game                # å°æ¸¸æˆé…ç½®
â””â”€â”€ nb-game               # æ–°æ¸¸æˆç½‘ç«™é…ç½®

# å¯ç”¨çš„ç«™ç‚¹
/etc/nginx/sites-enabled/
```

#### PM2 è¿›ç¨‹ç®¡ç†
```bash
# PM2é…ç½®æ–‡ä»¶
# é€šå¸¸åœ¨é¡¹ç›®æ ¹ç›®å½•æˆ– /etc/pm2/ ä¸‹
```

#### ç³»ç»ŸæœåŠ¡
```bash
# NginxæœåŠ¡
sudo systemctl status nginx
sudo systemctl restart nginx

# PM2æœåŠ¡ (å¦‚æœé…ç½®ä¸ºsystemd)
/etc/systemd/system/pm2-root.service
```

## ğŸ”§ å¸¸ç”¨ç»´æŠ¤å‘½ä»¤

### æœåŠ¡å™¨çŠ¶æ€æ£€æŸ¥
```bash
# ç³»ç»ŸçŠ¶æ€
uptime
df -h
free -h

# è¿›ç¨‹çŠ¶æ€
ps aux | grep node
pm2 list
pm2 status

# ç«¯å£ç›‘å¬
netstat -tlnp | grep :80
netstat -tlnp | grep :3000
```

### æ—¥å¿—æŸ¥çœ‹
```bash
# Nginxæ—¥å¿—
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

# PM2æ—¥å¿—
pm2 logs douyin-admin
pm2 logs douyin-admin --lines 50

# ç³»ç»Ÿæ—¥å¿—
sudo journalctl -u nginx -f
sudo journalctl -u pm2-root -f
```

### æ–‡ä»¶æƒé™æ£€æŸ¥
```bash
# æ£€æŸ¥é¡¹ç›®æ–‡ä»¶æƒé™
ls -la /var/www/douyin-admin-master/
ls -la /var/www/html/

# ä¿®å¤æƒé™ (å¦‚æœéœ€è¦)
sudo chown -R www-data:www-data /var/www/html/
sudo chown -R www-data:www-data /var/www/douyin-admin-master/
```

### æ•°æ®åº“æ“ä½œ
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /var/www/douyin-admin-master

# æ•°æ®åº“æ–‡ä»¶ä½ç½®
ls -la database.sqlite

# å¤‡ä»½æ•°æ®åº“
cp database.sqlite database.sqlite.backup

# ä½¿ç”¨è„šæœ¬æ£€æŸ¥æ•°æ®åº“
node scripts/show-db-data.js
node scripts/check-table-structure.js
```

## ğŸš€ éƒ¨ç½²ç›¸å…³

### å‰ç«¯éƒ¨ç½²
```bash
# ä¼˜å…ˆä½¿ç”¨éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰
./deploy-frontend.sh  # Linux
deploy-frontend.bat   # Windows

# æˆ–æ‰‹åŠ¨éƒ¨ç½²
# æœ¬åœ°æ„å»º
npm run build

# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp -i ~/.ssh/id_rsa_douyin -r dist/* root@47.115.94.203:/var/www/html/
```

### åç«¯éƒ¨ç½²
```bash
# ä¸Šä¼ ä»£ç 
scp -i ~/.ssh/id_rsa_douyin -r src/ root@47.115.94.203:/var/www/douyin-admin-master/

# é‡å¯æœåŠ¡
pm2 restart douyin-admin
```

### å¤‡ä»½æ“ä½œ
```bash
# è¿è¡Œå¤‡ä»½è„šæœ¬
cd /var/www
./backup_script.sh
```

## ğŸ” æ•…éšœæ’é™¤

### è¿æ¥é—®é¢˜
```bash
# æµ‹è¯•SSHè¿æ¥
ssh -v douyin-server

# æ£€æŸ¥å¯†é’¥æƒé™
ls -la ~/.ssh/id_rsa_douyin
chmod 600 ~/.ssh/id_rsa_douyin
```

### æœåŠ¡é—®é¢˜
```bash
# æ£€æŸ¥NginxçŠ¶æ€
sudo nginx -t
sudo systemctl status nginx

# æ£€æŸ¥PM2çŠ¶æ€
pm2 list
pm2 describe douyin-admin

# é‡å¯æœåŠ¡
sudo systemctl restart nginx
pm2 restart douyin-admin
```

### æƒé™é—®é¢˜
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /var/www/html/
ls -la /var/www/douyin-admin-master/

# ä¿®å¤æƒé™
sudo chown -R www-data:www-data /var/www/html/
sudo chown -R www-data:www-data /var/www/douyin-admin-master/
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### å®šæœŸæ£€æŸ¥é¡¹ç›®
```bash
# æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ
df -h /var/www

# æ£€æŸ¥æ•°æ®åº“å¤§å°
ls -lh /var/www/douyin-admin-master/database.sqlite

# æ£€æŸ¥æ—¥å¿—æ–‡ä»¶å¤§å°
du -sh /var/log/nginx/
pm2 logs --size
```

### æ¸…ç†æ“ä½œ
```bash
# æ¸…ç†Nginxæ—¥å¿—
sudo truncate -s 0 /var/log/nginx/*.log

# æ¸…ç†PM2æ—¥å¿—
pm2 flush

# æ¸…ç†æ—§å¤‡ä»½æ–‡ä»¶ (è°¨æ…æ“ä½œ)
find /var/www -name "*backup*" -type d -mtime +30
```

## ğŸ“ ç´§æ€¥è”ç³»

å¦‚é‡ä¸¥é‡é—®é¢˜ï¼š
1. æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€å’Œæ—¥å¿—
2. æŸ¥çœ‹PM2å’ŒNginxçŠ¶æ€
3. æ£€æŸ¥æ•°æ®åº“è¿æ¥
4. å¦‚éœ€è¦ï¼Œå¯å›æ»šåˆ°å¤‡ä»½ç‰ˆæœ¬

## ğŸ“ æ›´æ–°æ—¥å¿—

- **2025-12-19**: æ·»åŠ æ–°æ¸¸æˆæœåŠ¡å™¨nb.game985.vipé…ç½®ä¿¡æ¯
- **2025-10-11**: åˆå§‹ç‰ˆæœ¬åˆ›å»ºï¼ŒåŒ…å«å®Œæ•´çš„æœåŠ¡å™¨é…ç½®å’Œæ–‡ä»¶ä½ç½®ä¿¡æ¯